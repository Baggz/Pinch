(function(){var e=function(e){return e&&e.test&&e.exec};var t=function(e){return Object.prototype.toString.call(e)==="[object Array]"};var n=function(e){return Object.prototype.toString.call(e)==="[object Object]"};var r=function(e,t){if(e.length!==t.length)return false;return e.every(function(e,n,r){return t[n]===e})};var i=function(e,n,r){var i,s;if(t(e)){for(i=0,s=e.length;i<s;i++){n.apply(r,[i,e[i],e])}return}for(i in e){if(e.hasOwnProperty(i)){n.apply(r,[i,e[i],e])}}};var s=function(e){var t=[];var n=false;var r=0;var i=e.length;var s="";var o=function(){if(s){t.push(s);s=""}};for(;r<i;r++){if(e[r].match(/\[|\]/)){o();if(e[r]==="]"){n=false}else{n=true}}else if(e[r]!=='"'&&e[r]!=="'"){if(e[r]==="."&&!n){o()}else{s+=e[r]}}if(r===i-1){o()}}return t};var o=function(t,n,r){var i=["string","object"].indexOf(typeof t)!==-1;var s=typeof n==="string"||e(n);var o=["string","object","function"].indexOf(typeof r)!==-1;if(!i||!s||!o){return}if(typeof t==="string"){this.instance=JSON.parse(t);this.json=true}else{this.instance=t}this.pattern=typeof n==="string"?n.replace(/'/g,'"'):n;this.replacement=r;this.createIndex(this.instance)};o.prototype.createIndex=function(e,t){var n=this;this.index=this.index||[];t=t||"";i(e,function(e,r){var i;e=e+"";if(e.match(/^[a-zA-Z]+$/)){i=t?t+"."+e:e}else if(e.match(/\d+/)){i=t+"["+e+"]"}else{i=t+'["'+e+'"]'}n.index.push(i);if(typeof r==="object"){n.createIndex(r,i)}})};o.prototype.replace=function(){var t=this;i(this.index,function(n,i){if(e(t.pattern)&&i.match(t.pattern)){return t.replaceValue(i)}if(typeof t.pattern==="string"){var o=s(i);var u=s(t.pattern);if(r(o,u)){return t.replaceValue(i)}}});return this.json?JSON.stringify(this.instance):this.instance};o.prototype.replaceValue=function(e){var t=this;var n=s(e);n.reduce(function(r,i,s){if(s===n.length-1){var o;if(typeof t.replacement==="function"){o=t.replacement(e,i,r[i])}else{o=t.replacement}r[i]=o;return}return r[i]},this.instance)};var u=function(e,t,n,r){var i=new o(e,t,n);var s=i.replace();return typeof r==="function"?r(null,s):s};if(typeof module!=="undefined"&&module.exports){module.exports=u}else if(typeof define!=="undefined"){define(function(){return u})}else{this.pinch=u}})()