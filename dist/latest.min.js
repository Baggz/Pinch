(function(){var g=function(a,b,d){var c,e;if("[object Array]"===Object.prototype.toString.call(a))for(c=0,e=a.length;c<e;c++)b.apply(d,[c,a[c],a]);else for(c in a)a.hasOwnProperty(c)&&b.apply(d,[c,a[c],a])},i=function(a){var b;if("[object Array]"===Object.prototype.toString.call(a))return b=[],g(a,function(a,c){b.push(i(c))}),b;return"[object Object]"===Object.prototype.toString.call(a)?(b={},g(a,function(a,c){b[a]=i(c)}),b):a},h=function(a,b,d){var c=-1!==["string","object"].indexOf(typeof a),e=
"string"===typeof b||b&&b.test&&b.exec,f=-1!==["string","object","function"].indexOf(typeof d);c&&e&&f&&("string"===typeof a?(this.instance=JSON.parse(a),this.json=!0):this.instance=i(a),this.pattern=b,this.replacement=d,this.createIndex(this.instance))};h.prototype.createIndex=function(a,b){var d=this;this.index=this.index||[];b=b||"";g(a,function(a,e){var f,a=a+"";f=a.match(/^[a-zA-Z]+$/)?b?b+"."+a:a:a.match(/\d+/)?b+"["+a+"]":b+'["'+a+'"]';d.index.push(f);"object"===typeof e&&d.createIndex(e,f)})};
h.prototype.replace=function(){var a=this;g(this.index,function(b,d){if(a.pattern&&a.pattern.test&&a.pattern.exec&&d.match(a.pattern)||"string"===typeof a.pattern&&d===a.pattern)return a.replaceValue(d)});return this.json?JSON.stringify(this.instance):this.instance};h.prototype.replaceValue=function(a){var b=this,d=a.match(/([a-zA-Z0-9\s]+)/g);d.reduce(function(c,e,f){if(f===d.length-1)f="function"===typeof b.replacement?b.replacement(a,e,c[e]):b.replacement,c[e]=f;else return c[e]},this.instance)};
var j=function(a,b,d,c){a=(new h(a,b,d)).replace();return"function"===typeof c?c(null,a):a};"undefined"!==typeof module&&module.exports?module.exports=j:"undefined"!==typeof define?define(function(){return j}):this.pinch=j})();